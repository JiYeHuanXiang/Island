<!DOCTYPE html>
<html>
<head>
    <title>WebUI连接测试</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>WebUI连接测试</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(test, status, message) {
            const div = document.createElement('div');
            div.innerHTML = `<strong>${test}:</strong> <span style="color: ${status === 'PASS' ? 'green' : 'red'}">${status}</span> - ${message}`;
            results.appendChild(div);
        }
        
        async function runTests() {
            // 测试1: 基础HTTP连接
            try {
                const response = await fetch('http://localhost:8088');
                if (response.ok) {
                    addResult('HTTP服务器', 'PASS', '服务器响应正常');
                } else {
                    addResult('HTTP服务器', 'FAIL', `HTTP状态码: ${response.status}`);
                }
            } catch (error) {
                addResult('HTTP服务器', 'FAIL', `连接失败: ${error.message}`);
            }
            
            // 测试2: 设置API
            try {
                const response = await fetch('http://localhost:8088/api/settings');
                if (response.ok) {
                    const data = await response.json();
                    addResult('设置API', 'PASS', `配置加载成功: ${JSON.stringify(data)}`);
                } else {
                    addResult('设置API', 'FAIL', `HTTP状态码: ${response.status}`);
                }
            } catch (error) {
                addResult('设置API', 'FAIL', `API调用失败: ${error.message}`);
            }
            
            // 测试3: 命令API
            try {
                const response = await fetch('http://localhost:8088/command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({command: '.help'})
                });
                if (response.ok) {
                    const data = await response.json();
                    addResult('命令API', 'PASS', `命令处理成功: ${data.response.substring(0, 50)}...`);
                } else {
                    addResult('命令API', 'FAIL', `HTTP状态码: ${response.status}`);
                }
            } catch (error) {
                addResult('命令API', 'FAIL', `命令API调用失败: ${error.message}`);
            }
            
            // 测试4: WebSocket连接
            try {
                const ws = new WebSocket('ws://localhost:8088/ws');
                ws.onopen = function() {
                    addResult('WebSocket连接', 'PASS', 'WebSocket连接建立成功');
                    ws.close();
                };
                ws.onerror = function(error) {
                    addResult('WebSocket连接', 'FAIL', `WebSocket连接失败: ${error}`);
                };
                ws.onclose = function() {
                    addResult('WebSocket连接', 'PASS', 'WebSocket连接正常关闭');
                };
            } catch (error) {
                addResult('WebSocket连接', 'FAIL', `WebSocket创建失败: ${error.message}`);
            }
            
            // 测试5: 静态资源
            try {
                const response = await fetch('http://localhost:8088/css/styles.css');
                if (response.ok) {
                    addResult('CSS资源', 'PASS', 'CSS文件加载成功');
                } else {
                    addResult('CSS资源', 'FAIL', `CSS加载失败: ${response.status}`);
                }
            } catch (error) {
                addResult('CSS资源', 'FAIL', `CSS加载错误: ${error.message}`);
            }
            
            try {
                const response = await fetch('http://localhost:8088/js/app.js');
                if (response.ok) {
                    addResult('JavaScript资源', 'PASS', 'JS文件加载成功');
                } else {
                    addResult('JavaScript资源', 'FAIL', `JS加载失败: ${response.status}`);
                }
            } catch (error) {
                addResult('JavaScript资源', 'FAIL', `JS加载错误: ${error.message}`);
            }
        }
        
        // 页面加载完成后运行测试
        window.onload = runTests;
    </script>
</body>
</html>
